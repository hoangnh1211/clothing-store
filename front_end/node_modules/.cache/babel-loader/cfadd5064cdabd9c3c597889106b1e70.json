{"ast":null,"code":"var express = require('express');\n\nvar app = express();\n\nvar session = require('express-session');\n\nvar sql = require(\"mssql\");\n\nvar fs = require('fs');\n\nvar passport = require('passport');\n\nvar LocalStrategy = require('passport-local').Strategy;\n\nvar config = {\n  user: 'hoanganh1',\n  password: 'hoanganh23',\n  server: 'localhost',\n  database: 'hoanganh'\n};\n\nconst Sequelize = require('sequelize');\n\nconst sequelize = new Sequelize({\n  dialect: 'mssql',\n  database: 'hoanganh',\n  username: 'hoanganh1',\n  host: 'localhost',\n  port: '1433',\n  password: 'hoanganh23',\n  logging: true\n});\n\nvar LocalStrategy = require('passport-local').Strategy;\n\nvar passport = require('passport'); // var bcrypt = require('bcrypt')\n\n\nvar bodyParser = require('body-parser');\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({\n  extended: true\n}));\napp.post('/create', function (req, res, next) {\n  var body = req.body;\n  var email = body.email;\n  var password = body.password;\n  res.send(body);\n  var sql1 = \"insert into khachhang values (\" + \"'\" + body.name + \"'\" + \",\" + \"'\" + body.username + \"'\" + \",\" + \"'\" + body.password + \"'\" + \");\" + \"create table \" + body.username + \" (id int, ten varchar(50));\";\n  sequelize.query(sql1);\n});\napp.get('/data', function (req, res) {\n  sql.connect(config, function (err) {\n    if (err) console.log(err);\n    var request = new sql.Request();\n    request.query('select * from Company ', function (err, recordset) {\n      sql.close();\n      res.json(recordset.recordsets[0]);\n    });\n  });\n});\napp.get('/anh', function (req, res) {\n  res.sendFile(__dirname + \"/anh/tải xuống.jpg\");\n});\napp.use(express.static('anh'));\napp.get('/logo', function (req, res) {\n  res.sendFile(__dirname + \"/anh/logo.png\");\n});\napp.get('/logo1', function (req, res) {\n  res.sendFile(__dirname + \"/anh/logo1.png\");\n});\napp.get('/dataa', function (req, res) {\n  sql.connect(config, function (err) {\n    if (err) console.log(err);\n    var request = new sql.Request();\n    request.query('select * from Product ', function (err, recordset) {\n      sql.close();\n      res.json(recordset.recordsets[0]);\n    });\n  });\n});\napp.use(passport.initialize());\napp.use(session({\n  secret: \"mysecret\"\n}));\napp.use(passport.session());\napp.route('/login').post(passport.authenticate('local', {\n  failureRedirect: '/login',\n  successRedirect: '/abc'\n}));\npassport.use(new LocalStrategy(function (username, password, done) {\n  sequelize.query(\"SELECT * FROM khachhang\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    console.log(users);\n    const db = users;\n    console.log(db);\n    const userabc = db.find(user => user.username == username);\n\n    if (userabc && userabc.password == password) {\n      return done(null, userabc);\n    } else {\n      return done(null, false);\n    }\n  });\n}));\npassport.serializeUser(function (user, done) {\n  done(null, user.username);\n});\nsequelize.authenticate().then(function () {\n  console.log('adad');\n});\napp.listen(4000, function () {\n  console.log('Server is running..on Port 4000');\n});","map":null,"metadata":{},"sourceType":"script"}