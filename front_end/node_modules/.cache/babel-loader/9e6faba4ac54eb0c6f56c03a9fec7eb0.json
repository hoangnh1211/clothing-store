{"ast":null,"code":"var express = require('express');\n\nvar app = express();\n\nvar session = require('express-session');\n\nvar sql = require(\"mssql\");\n\nvar fs = require('fs');\n\nvar passport = require('passport');\n\nvar LocalStrategy = require('passport-local').Strategy;\n\nlet multer = require(\"multer\");\n\nlet path = require(\"path\");\n\nvar config = {\n  user: 'hoanganh1',\n  password: 'nhatle12',\n  server: 'localhost',\n  database: 'hoanganh'\n};\nvar config1 = {\n  user: 'hoanganh1',\n  password: 'nhatle12',\n  server: 'localhost',\n  database: 'anh'\n};\n\nconst Sequelize = require('sequelize');\n\nconst sequelize = new Sequelize({\n  dialect: 'mssql',\n  database: 'hoanganh',\n  username: 'hoanganh1',\n  host: 'localhost',\n  port: '1433',\n  password: 'nhatle12',\n  logging: true\n});\n\nvar LocalStrategy = require('passport-local').Strategy;\n\nvar passport = require('passport'); // var bcrypt = require('bcrypt')\n\n\nvar bodyParser = require('body-parser');\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({\n  extended: true\n}));\napp.get('/shirt/abcabc', function (req, res, next) {\n  var body = req.body; // console.log(body);\n\n  res.send(\"body\"); //  var sql1 = \"insert into khachhang values (\"+\"'\"+body.name+\"'\"+\",\"+\"'\"+body.username+\"'\"+\",\"+\"'\"+body.password+\"'\"+ \");\" +\"create table \"+body.username+\" (id int, ten varchar(50));\";\n  //  sequelize.query(sql1);\n});\napp.get('/data', function (req, res) {\n  sql.connect(config, function (err) {\n    if (err) console.log(err);\n    var request = new sql.Request();\n    request.query('select * from Khachhang ', function (err, recordset) {\n      sql.close();\n      res.json(recordset.recordsets[0]);\n      console.log(res.json(recordset.recordsets[0]));\n    });\n  });\n});\napp.get('/shirt1', function (req, res) {\n  sequelize.query(\"select * from products where (Link LIKE 'len%' or Link LIKE 'somi%' or Link LIKE 'thun%' or Link LIKE 'khoac%' );\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.post('/datasingle', function (req, res) {\n  var body = req.body;\n  sequelize.query(\"select * from products where (Link LIKE '\" + body.name + \"%');\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.post('/datageneral', function (req, res) {\n  var body = req.body.name;\n  console.log(req.body);\n  var sql = \"select * from products where (\";\n\n  for (var i = 0; i < body.length; i++) {\n    if (i !== body.length - 1) {\n      sql = sql + \"Link like '\" + body[i] + \"%' or \";\n    } else {\n      sql = sql + \"Link like '\" + body[i] + \"%')\";\n    }\n  }\n\n  sequelize.query(sql, {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/vay1', function (req, res) {\n  sequelize.query(\"select * from products where (Link LIKE 'dam%' or Link like 'yem%' or Link like 'jum%');\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/vay1_jum', function (req, res) {\n  sequelize.query(\"select * from products where (Link LIKE 'jum%' );\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/vay1_dam', function (req, res) {\n  sequelize.query(\"select * from products where (Link LIKE 'dam%' );\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/vay1_yem', function (req, res) {\n  sequelize.query(\"select * from products   where (Link like 'yem%' );\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/trouser1', function (req, res) {\n  sequelize.query(\"select * from products where (Link LIKE 'sooc%' or Link LIKE 'jean%' or Link LIKE 'baggy%' );\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/trouser1_sooc', function (req, res) {\n  sequelize.query(\"select * from products where Link LIKE 'sooc%';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/trouser1_jean', function (req, res) {\n  sequelize.query(\"select * from products where Link LIKE 'jean%';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/trouser1_baggy', function (req, res) {\n  sequelize.query(\"select * from products where Link LIKE 'baggy';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/shirt1_len', function (req, res) {\n  sequelize.query(\"select * from products where Link LIKE 'len%';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/shirt1_thun', function (req, res) {\n  sequelize.query(\"select * from products where Link LIKE 'thun%';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/products', function (req, res) {\n  sequelize.query(\"select * from products ;\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/shirt1_khoac', function (req, res) {\n  sequelize.query(\"select * from products where Link LIKE N'khoac';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\napp.get('/shirt1_somi', function (req, res) {\n  sequelize.query(\"select * from products where Link LIKE 'somi%';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    // console.log(users)\n    res.send(users);\n  });\n});\nsequelize.query(\"select Link from products;\", {\n  type: sequelize.QueryTypes.SELECT\n}).then(users => {\n  // console.log(users);\n  users.map((menu, index) => {\n    var path = '/anh/';\n    var path1 = path + menu.Link + '_1';\n    var path2 = path + menu.Link + '_2';\n    var path3 = path + menu.Link + '_3';\n    var path4 = path + menu.Link + '_4';\n    var path5 = path + menu.Link + '_5';\n    var path6 = path + menu.Link + '_nho1';\n    var path7 = path + menu.Link + '_nho2';\n    var path8 = path + menu.Link + '_nho3';\n    var path9 = path + menu.Link + '_nho4';\n    var path10 = path + menu.Link + '_nho5';\n    var path11 = path + menu.Link + '_to1';\n    var path12 = path + menu.Link + '_to2';\n    var path13 = path + menu.Link + '_to3';\n    var path14 = path + menu.Link + '_to4';\n    var path15 = path + menu.Link + '_to5';\n    var link1 = '/anh/' + menu.Link + '_1' + '.jpg';\n    var link2 = '/anh/' + menu.Link + '_2' + '.jpg';\n    var link3 = '/anh/' + menu.Link + '_3' + '.jpg';\n    var link4 = '/anh/' + menu.Link + '_4' + '.jpg';\n    var link5 = '/anh/' + menu.Link + '_5' + '.jpg';\n    var link6 = '/anh/' + menu.Link + '_nho1' + '.jpg';\n    var link7 = '/anh/' + menu.Link + '_nho2' + '.jpg';\n    var link8 = '/anh/' + menu.Link + '_nho3' + '.jpg';\n    var link9 = '/anh/' + menu.Link + '_nho4' + '.jpg';\n    var link10 = '/anh/' + menu.Link + '_nho5' + '.jpg';\n    var link11 = '/anh/' + menu.Link + '_to1' + '.jpg';\n    var link12 = '/anh/' + menu.Link + '_to2' + '.jpg';\n    var link13 = '/anh/' + menu.Link + '_to3' + '.jpg';\n    var link14 = '/anh/' + menu.Link + '_to4' + '.jpg';\n    var link15 = '/anh/' + menu.Link + '_to5' + '.jpg';\n    app.get(path1, function (req, res) {\n      res.sendFile(__dirname + link1);\n    });\n    app.get(path2, function (req, res) {\n      res.sendFile(__dirname + link2);\n    });\n    app.get(path3, function (req, res) {\n      res.sendFile(__dirname + link3);\n    });\n    app.get(path4, function (req, res) {\n      res.sendFile(__dirname + link4);\n    });\n    app.get(path5, function (req, res) {\n      res.sendFile(__dirname + link5);\n    });\n    app.get(path6, function (req, res) {\n      res.sendFile(__dirname + link6);\n    });\n    app.get(path7, function (req, res) {\n      res.sendFile(__dirname + link7);\n    });\n    app.get(path8, function (req, res) {\n      res.sendFile(__dirname + link8);\n    });\n    app.get(path9, function (req, res) {\n      res.sendFile(__dirname + link9);\n    });\n    app.get(path10, function (req, res) {\n      res.sendFile(__dirname + link10);\n    });\n    app.get(path11, function (req, res) {\n      res.sendFile(__dirname + link11);\n    });\n    app.get(path12, function (req, res) {\n      res.sendFile(__dirname + link12);\n    });\n    app.get(path13, function (req, res) {\n      res.sendFile(__dirname + link13);\n    });\n    app.get(path14, function (req, res) {\n      res.sendFile(__dirname + link14);\n    });\n    app.get(path15, function (req, res) {\n      res.sendFile(__dirname + link15);\n    });\n  });\n});\napp.get('/anh/banner3', function (req, res) {\n  res.sendFile(__dirname + \"/anh/banner.jpg\");\n});\napp.get('/92vay', function (req, res) {\n  res.sendFile(__dirname + \"/anh/92vay.jpg\");\n});\napp.get('/92quan', function (req, res) {\n  res.sendFile(__dirname + \"/anh/92quan.jpg\");\n});\napp.get('/anh', function (req, res) {\n  res.sendFile(__dirname + \"/anh/logo.jpg\");\n});\napp.use(express.static('anh'));\napp.get('/logo', function (req, res) {\n  res.sendFile(__dirname + \"/anh/logo.png\");\n});\napp.get('/anh/menu-ao-92w', function (req, res) {\n  res.sendFile(__dirname + \"/anh/menu-ao-92w.jpg\");\n});\napp.get('/anh/banner2', function (req, res) {\n  res.sendFile(__dirname + \"/anh/banner2.jpg\");\n});\napp.get('/anh/banner4', function (req, res) {\n  res.sendFile(__dirname + \"/anh/80.jpg\");\n});\napp.get('/anh/ao', function (req, res) {\n  res.sendFile(__dirname + \"/anh/ao.jpg\");\n});\napp.get('/anh/nhom', function (req, res) {\n  res.sendFile(__dirname + \"/anh/nhom.jpg\");\n});\napp.get('/anh/thay', function (req, res) {\n  res.sendFile(__dirname + \"/anh/thay.jpg\");\n});\napp.get('/anh/thay1', function (req, res) {\n  res.sendFile(__dirname + \"/anh/thay1.jpg\");\n});\napp.get('/anh/duc', function (req, res) {\n  res.sendFile(__dirname + \"/anh/duc.jpg\");\n});\napp.get('/anh/tra', function (req, res) {\n  res.sendFile(__dirname + \"/anh/tra.jpg\");\n});\napp.get('/anh/dat', function (req, res) {\n  res.sendFile(__dirname + \"/anh/dat.jpg\");\n});\napp.get('/anh/hoanganh', function (req, res) {\n  res.sendFile(__dirname + \"/anh/hoanganh.jpg\");\n});\napp.get('/anh/quan', function (req, res) {\n  res.sendFile(__dirname + \"/anh/quan.jpg\");\n});\napp.get('/anh/vay', function (req, res) {\n  res.sendFile(__dirname + \"/anh/vay.jpg\");\n});\napp.get('/anh/banner-web-92_1', function (req, res) {\n  res.sendFile(__dirname + \"/anh/banner-web-92_1.jpg\");\n});\napp.get('/logo1', function (req, res) {\n  res.sendFile(__dirname + \"/anh/logo1.png\");\n});\napp.get('/bct', function (req, res) {\n  res.sendFile(__dirname + \"/anh/bct.jpg\");\n});\napp.get('/anh/111', function (req, res) {\n  res.sendFile(__dirname + \"/anh/2.jpg\");\n});\napp.use(passport.initialize());\napp.use(session({\n  secret: \"mysecret\",\n  saveUninitialized: true,\n  resave: false,\n  cookie: {\n    maxAge: 1000 * 60 * 60 * 24\n  }\n}));\napp.use(passport.session());\napp.post('/login1', (req, res) => {\n  body = req.body;\n  sequelize.query(\"SELECT * FROM khachhang\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    console.log(users);\n    const db = users;\n    const userabc = db.find(user => user.username == body.username);\n    console.log(userabc);\n\n    if (userabc && userabc.password == body.password) {\n      req.session.username = req.body.username;\n      req.session.name = userabc.name;\n      return res.send(\"thanh cong\");\n    } else {\n      req.session.username = undefined;\n      req.session.name = undefined;\n      res.send(\"that bai\");\n    }\n  });\n});\napp.post('/loginadmin', (req, res) => {\n  body = req.body;\n  sequelize.query(\"SELECT * FROM admin1\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    console.log(users);\n    const db = users;\n    const userabc = db.find(user => user.username == body.username);\n    console.log(userabc);\n\n    if (userabc && userabc.password == body.password) {\n      req.session.usernameadmin = req.body.username; // req.session.name=userabc.name;\n\n      console.log(req.session.usernameadmin, 'aaa', req.session.username);\n      return res.send(\"thanh cong\");\n    } else {\n      req.session.usernameadmin = undefined; // req.session.name = undefined ;\n\n      console.log(session.session);\n      res.send(\"that bai\");\n    }\n  });\n});\napp.post('/search', (req, res) => {\n  var search = req.body.search;\n  sequelize.query(\"select * from products where ( Name LIKE N'%\" + search + \"%' or name_kodau like N'%\" + search + \"%');\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    app.get('/search2', (req, res) => {\n      res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000');\n      if (search) return res.send(search);else res.send('ALL');\n    });\n    app.get('/search1', (req, res) => {\n      res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000');\n      if (users) return res.send(users);else res.send('');\n    });\n  });\n});\napp.post('/create', (req, res) => {\n  var body = req.body;\n  sequelize.query(\"SELECT * FROM khachhang\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    console.log(users);\n    const db = users;\n    const userabc = db.find(user => user.username == body.username);\n    console.log(userabc);\n\n    if (userabc && userabc.password == body.password) {\n      return res.send(\"that bai\");\n    } else {\n      var sql1 = \"insert into khachhang values (\" + \"N'\" + body.name + \"'\" + \",\" + \"'\" + body.username + \"'\" + \",\" + \"'\" + body.password + \"'\" + \");\"; // var sql1=\"insert into khachhang values ( 'name')\"\n\n      sequelize.query(sql1);\n      req.session.username = body.username;\n      req.session.name = body.name; // console.log(req.session);   \n      // console.log(body);\n\n      res.send(\"thanh cong\");\n    }\n  });\n});\napp.get('/test', (req, res) => {\n  res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000');\n  if (req.session.username) return res.send(req.session.username);else res.send('chua dang nhap');\n});\napp.get('/testadmin', (req, res) => {\n  res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000');\n  if (req.session.usernameadmin) return res.send(req.session.usernameadmin);else res.send('chua dang nhap');\n});\napp.get('/test1', (req, res) => {\n  res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000'); // console.log('b',req.session)\n\n  if (req.session.name) return res.send(req.session.name);else res.send('chua dang nhap');\n});\napp.get('/logout', (req, res) => {\n  req.session.username = undefined;\n  req.session.name = undefined;\n  res.send(\"dang xuat\");\n});\nsequelize.authenticate().then(function () {\n  console.log('adad');\n});\napp.post(\"/add\", (req, res) => {\n  var body = req.body;\n  sequelize.query(\"select order2.username,order2.id,order2.soluong,order2.size,Products.Name,Products.NewPrice,Products.Link from order2 inner join Products on order2.id=Products.id where ( order2.username='\" + req.session.username + \"' and order2.id=\" + body.id + \" and order2.size='\" + body.size + \"');\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    console.log(users.length);\n    console.log('a');\n    const db = users; // c\n\n    if (db.length > 0) {\n      var sql1 = \"UPDATE order2 set soluong=soluong+\" + body.soluong + \" where (username='\" + req.session.username + \"' and id=\" + body.id + \" and size='\" + body.size + \"');\";\n      sequelize.query(sql1);\n      return;\n    } else {\n      var sql1 = \"insert into order2 values (\" + \"N'\" + req.session.username + \"'\" + \",\" + \"'\" + body.id + \"'\" + \",\" + \"'\" + body.soluong + \"',\" + \"'\" + body.size + \"'\" + \");\";\n      sequelize.query(sql1);\n    }\n  });\n});\nlet diskStorage = multer.diskStorage({\n  destination: (req, file, callback) => {\n    callback(null, \"anh\");\n  },\n  filename: (req, file, callback) => {\n    let math = [\"image/png\", \"image/jpeg\"];\n\n    if (math.indexOf(file.mimetype) === -1) {\n      let errorMess = \"The file <strong>\".concat(file.originalname, \"</strong> is invalid. Only allowed to upload image jpeg or png.\");\n      return callback(errorMess, null);\n    }\n\n    let filename = \"\".concat(file.originalname);\n    callback(null, filename);\n  }\n});\nlet uploadFile = multer({\n  storage: diskStorage\n}).array(\"file\");\napp.post('/addproduct', (req, res) => {\n  var body = req.body;\n  console.log(body);\n  sequelize.query(\"insert into Products values (N'\" + body.Name + \"',\" + body.Price + \",\" + body.NewPrice + \",'\" + body.Link + \"',N'\" + body.Description + \"','\" + body.name_kodau + \"')\");\n});\napp.get('/orderadmin1', (req, res) => {\n  res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000');\n  var data = req.session.orderadmin;\n  console.log('a:', data, 'aa', req.session);\n  if (data) return res.send(data); // else res.send('a')\n  else {\n      var today = new Date();\n      var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();\n      var tomorow = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + (today.getDate() + 1);\n      var data = {\n        data: [],\n        time: []\n      };\n      sequelize.query(\"select history.username,history.id,history.soluong,history.size,history.time,Products.Name,Products.NewPrice,Products.Link from history join Products on history.id=Products.id where history.time>='\" + date + \"' and history.time<'\" + tomorow + \"'\", {\n        type: sequelize.QueryTypes.SELECT\n      }).then(users => {\n        // res.send(data)\n        data.data = users;\n        sequelize.query(\"select DISTINCT time,username from history where time>='\" + date + \"' and time<'\" + tomorow + \"' order by time \", {\n          type: sequelize.QueryTypes.SELECT\n        }).then(users => {\n          data.time = users;\n          res.send(data); // console.log(data)\n        });\n      });\n    }\n  ;\n});\napp.get('/revenue12', (req, res) => {\n  res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000');\n  var today = new Date();\n  var month = today.getMonth() + 1;\n  sequelize.query(\"select history.soluong,Products.NewPrice from history join Products on history.id=Products.id where MONTH(history.time)=\" + month, {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    var tong = [0, 0, 0, 0, 0, 0];\n    users.map((user, index) => {\n      if (index <= 5) {\n        tong[0] = tong[0] + user.soluong * user.NewPrice;\n      } else if (index <= 10) {\n        tong[1] = tong[1] + user.soluong * user.NewPrice;\n      } else if (index <= 15) {\n        tong[2] = tong[2] + user.soluong * user.NewPrice;\n      } else if (index <= 20) {\n        tong[3] = tong[3] + user.soluong * user.NewPrice;\n      } else if (index <= 25) {\n        tong[4] = tong[4] + user.soluong * user.NewPrice;\n      } else {\n        tong[5] = tong[5] + user.soluong * user.NewPrice;\n      }\n    });\n    res.send(tong);\n  });\n});\napp.post('/orderadmin', (req, res) => {\n  var body = req.body;\n  console.log(body);\n  var date = body.date;\n  var tomorow = body.tomorow;\n  var data = {\n    data: [],\n    time: []\n  };\n  sequelize.query(\"select history.username,history.id,history.soluong,history.size,history.time,Products.Name,Products.NewPrice,Products.Link from history join Products on history.id=Products.id where history.time>='\" + date + \"' and history.time<'\" + tomorow + \"'\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    data.data = users;\n    sequelize.query(\"select DISTINCT time,username from history where time>='\" + date + \"' and time<'\" + tomorow + \"' order by time \", {\n      type: sequelize.QueryTypes.SELECT\n    }).then(users => {\n      data.time = users;\n      res.send(data);\n    });\n  });\n});\napp.post('/repairproduct', (req, res) => {\n  var body = req.body;\n  console.log(body);\n  sequelize.query(\"insert into Products values (N'\" + body.Name + \"',\" + body.Price + \",\" + body.NewPrice + \",'\" + body.Link + \"',N'\" + body.Description + \"','\" + body.name_kodau + \"')\");\n  var n = \"update Products set Name=N'\" + body.Name + \"',Price=\" + body.Price + \",NewPrice=\" + body.NewPrice + \",Link='\" + body.Link + \"',Description=N'\" + body.Description + \"',name_kodau='\" + body.name_kodau + \"' where id=\" + body.id;\n  sequelize.query(n);\n});\napp.post(\"/addimg1\", (req, res) => {\n  uploadFile(req, res, error => {\n    // Nếu có lỗi thì trả về lỗi cho client.\n    // Ví dụ như upload một file không phải file ảnh theo như cấu hình của mình bên trên\n    if (error) {\n      return res.send(\"Error when trying to upload: \".concat(error));\n    }\n\n    console.log(req.files); // req.files.map((menu, index) => {\n    //     res.sendFile(path.join(`${__dirname}/uploads/${menu.filename}`));\n    // })\n  });\n});\napp.post('/update', (req, res) => {\n  body = req.body;\n  res.send(body);\n  sequelize.query(\"delete from order2 where username='\" + req.session.username + \"';\"); // body.map()\n\n  body.data.map((menu, index) => {\n    if (menu.soluong <= 0) {\n      var sql1 = \"delete from order2 where ( username='\" + req.session.username + \"' and id=\" + menu.id + \" and size='\" + menu.size + \"')\";\n      sequelize.query(sql1);\n    } else {\n      var sql1 = \"insert into order2 values (\" + \"N'\" + menu.username + \"'\" + \",\" + \"'\" + menu.id + \"'\" + \",\" + \"'\" + menu.soluong + \"',\" + \"'\" + menu.size + \"'\" + \");\";\n      sequelize.query(sql1);\n    }\n  });\n});\napp.post('/thanhtoan', (req, res) => {\n  body = req.body.data;\n  console.log(body);\n  sql1 = \"insert into history values\"; // res.send(body)\n\n  var menu = body;\n  var d = 0;\n\n  for (var i = 0; i <= menu.length - 1; i++) {\n    if (menu[i].soluong > 0) {\n      d = d + 1;\n    }\n  }\n\n  if (d == 1) {\n    for (var i = 0; i <= menu.length - 1; i++) {\n      if (menu[i].soluong > 0) {\n        sql1 = sql1 + \"('\" + menu[i].username + \"'\" + \",\" + \"'\" + menu[i].id + \"'\" + \",\" + \"'\" + menu[i].soluong + \"',\" + \"'\" + menu[i].size + \"', GETDATE() \" + \");\";\n      }\n    }\n  } else {\n    for (var i = 0; i <= menu.length - 1; i++) {\n      if (menu[i].soluong > 0) {\n        if (i != menu.length - 1) {\n          sql1 = sql1 + \"('\" + menu[i].username + \"'\" + \",\" + \"'\" + menu[i].id + \"'\" + \",\" + \"'\" + menu[i].soluong + \"',\" + \"'\" + menu[i].size + \"', GETDATE() \" + \"),\";\n        } else {\n          sql1 = sql1 + \"('\" + menu[i].username + \"'\" + \",\" + \"'\" + menu[i].id + \"'\" + \",\" + \"'\" + menu[i].soluong + \"',\" + \"'\" + menu[i].size + \"', GETDATE() \" + \");\";\n        }\n      }\n    }\n  }\n\n  sequelize.query(sql1);\n});\napp.post('/clear', (req, res) => {\n  body = req.body;\n  res.send(body);\n  sequelize.query(\"delete from order2 where username='\" + req.session.username + \"';\");\n});\napp.post('/delete', (req, res) => {\n  body = req.body;\n  res.send(body);\n  sequelize.query(\"delete from order2 where username='\" + req.session.username + \"'\" + \" and id=\" + body.id + \" and size='\" + body.size + \"';\");\n}); // console.log(session);\n\napp.post('/user', (req, res) => {\n  var body = req.body;\n  var email = body.email;\n  var password = body.password;\n  res.send(body);\n});\napp.get('/order', function (req, res) {\n  sequelize.query(\"select order2.username,order2.id,order2.soluong,order2.size,Products.Name,Products.NewPrice,Products.Link from order2 inner join Products on order2.id=Products.id;\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    res.send(users); // console.log(users)\n  });\n});\napp.get('/order1', function (req, res) {\n  sequelize.query(\"select order2.username,order2.id,order2.soluong,order2.size,Products.Name,Products.NewPrice,Products.Link from order2 inner join Products on order2.id=Products.id;\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    res.send(users); // console.log(users)\n  });\n});\napp.get('/history', function (req, res) {\n  sequelize.query(\"select history.username,history.id,history.soluong,history.size,history.time,Products.Name,Products.NewPrice,Products.Link from history join Products on history.id=Products.id where history.username='\" + req.session.username + \"';\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    res.send(users); // console.log(users)\n  });\n});\napp.get('/history_time', function (req, res) {\n  sequelize.query(\"select DISTINCT time from history where username='\" + req.session.username + \"' order by time desc;\", {\n    type: sequelize.QueryTypes.SELECT\n  }).then(users => {\n    res.send(users); // console.log(users)\n  });\n});\napp.listen(4000, function () {\n  console.log('Server is running..on Port 4000');\n});","map":null,"metadata":{},"sourceType":"script"}